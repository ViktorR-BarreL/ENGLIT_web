<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ENGLIT - Изучение английского</title>
    <link rel="stylesheet" href="style.css">
    <!-- Добавлена библиотека Chart.js для графиков -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Экран входа (без изменений) -->
    <div id="login-screen">
        <h1>Добро пожаловать в ENGLIT!</h1>
        <p>Войдите, чтобы начать изучение слов.</p>
        <button id="loginBtn">Войти через Google</button>
    </div>

    <!-- Основной контент приложения (скрыт до входа) -->
    <div id="app-content" style="display: none;">
        <!-- НОВЫЙ БЛОК: Главное окно по макету -->
        <div class="main-layout" id="mainLayout">
            <header class="app-header">
                <h1 class="app-title">ENGLIT</h1>
                <div class="user-profile-circle" id="userProfileCircle">
                    <!-- Здесь будет аватар или иконка пользователя -->
                </div>
            </header>

            <div class="main-content-area">
                <div class="left-panel">
                    <div class="category-selection">
                        <input type="text" id="selectedCategoryDisplay" placeholder="Категория слов" readonly>
                        <button id="selectCategoryBtn">выбрать категорию</button>
                    </div>

                    <div class="main-buttons-grid">
                        <button class="action-button" id="learnNewWordsBtn">Изучить новые слова</button>
                        <button class="action-button" id="repeatWordsBtn">Повторение слов</button>
                        <button class="action-button" id="dictionaryBtn">Словарь</button>
                        <button class="action-button" id="myWordsBtn">Свои слова</button>
                    </div>
                </div>

                <!-- БЛОК СТАТИСТИКИ -->
                <div class="right-panel">
                    <div class="statistics-header">
                        <h3>Статистика</h3>
                        <div class="total-learned-words">
                            <p>Всего изучено слов</p>
                            <span id="total-learned-count">0</span>
                        </div>
                    </div>
                    <div class="statistics-filters">
                        <button class="filter-btn active" data-period="all">Все</button>
                        <button class="filter-btn" data-period="3m">3 месяца</button>
                        <button class="filter-btn" data-period="1m">Месяц</button>
                        <button class="filter-btn" data-period="1w">Неделя</button>
                    </div>
                    <div class="statistics-chart-container">
                        <canvas id="statisticsChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Модальное окно выбора категорий -->
        <div id="categoryModal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Выбор категории слов</h2>
                    <span class="close-button">&times;</span>
                </div>
                <div id="categoryGrid" class="category-grid">
                    <!-- Категории будут загружены сюда из JS -->
                </div>
            </div>
        </div>

        <!-- Страница изучения слов -->
        <div id="learning-page" class="learning-page-container" style="display: none;">
            <div class="learning-header">
                <button id="backToMainBtn" class="back-button">&larr; Назад</button>
                <div class="progress-bar-container">
                    <div id="learningProgressBar" class="progress-bar-fill"></div>
                </div>
            </div>
            <div class="word-display-area">
                <button id="prevWordBtn" class="nav-arrow">&lt;</button>
                <div class="word-card-learning">
                    <div id="wordDisplay" class="word-text-large"></div>
                    <div id="translationDisplay" class="word-translation"></div>
                    <div id="transcriptionDisplay" class="word-transcription"></div>
                    <div id="exampleDisplay" class="word-example"></div>
                    <div class="learning-actions">
                        <button id="knowWordBtn" class="learning-action-button know-it">Знаю слово</button>
                        <button id="learnItBtn" class="learning-action-button learn-it">Учить</button>
                    </div>
                </div>
                <button id="nextWordBtn" class="nav-arrow">&gt;</button>
            </div>
        </div>

        <!-- Страница повторения слов (тестирование) -->
        <div id="repeat-page" class="repeat-page-container" style="display: none;">
            <div class="repeat-header">
                <button id="backToMainFromRepeatBtn" class="back-button">&larr; Назад</button>
                <select id="testFormatSelect" class="test-format-select">
                    <option value="view">Просмотр перевода</option>
                    <option value="multiple-choice">Множественный выбор</option>
                    <option value="text-input">Ввод ответа</option>
                </select>
                <div class="progress-bar-container repeat-progress">
                    <div id="repeatProgressBar" class="progress-bar-fill"></div>
                </div>
            </div>

            <div class="repeat-content">
                <div class="word-card-repeat">
                    <div id="repeatWordDisplay" class="repeat-word-text">Слово</div>
                    <div id="testOptionsContainer" class="test-options-container">
                        <!-- Здесь будут варианты тестирования или поле ввода -->
                        <p class="placeholder-text">Нажмите "Начать тест", чтобы начать.</p>
                    </div>
                    <div id="feedbackMessage" class="feedback-message"></div>
                </div>
            </div>
            <div class="repeat-actions">
                <button id="startTestBtn" class="repeat-action-button primary">Начать тест</button>
                <button id="checkAnswerBtn" class="repeat-action-button primary" style="display: none;">Проверить</button>
                <button id="nextQuestionBtn" class="repeat-action-button secondary" style="display: none;">Далее</button>
                <button id="finishTestBtn" class="repeat-action-button primary" style="display: none;">Завершить тест</button>
            </div>
            
            <div id="testResultsContainer" class="test-results-container" style="display: none;">
                <h3>Результаты теста:</h3>
                <p>Правильных ответов: <span id="correctAnswersCount">0</span></p>
                <p>Неправильных ответов: <span id="incorrectAnswersCount">0</span></p>
                <button id="restartTestBtn" class="repeat-action-button primary">Начать заново</button>
            </div>
        </div>

        <!-- Страница словаря -->
        <div id="dictionary-page" class="dictionary-page-container" style="display: none;">
            <div class="dictionary-header">
                <button id="backToMainFromDictBtn" class="back-button">&larr; Назад</button>
                <h2 class="dictionary-title">Словарь</h2>
                <input type="text" id="dictionarySearchInput" class="dictionary-search" placeholder="Поиск слова...">
            </div>
            <div class="dictionary-columns-container">
                <div class="dict-column">
                    <h3>Исходный словарь</h3>
                    <div id="source-words-container" class="words-container dict-words-container"></div>
                </div>
                <div class="dict-column">
                    <h3>Изученные слова</h3>
                    <div id="learned-words-container-dict" class="words-container dict-words-container"></div>
                </div>
                <div class="dict-column">
                    <h3>Добавленные слова</h3>
                    <div id="added-words-container-dict" class="words-container dict-words-container"></div>
                </div>
            </div>
        </div>
        
        <!-- Страница "Свои слова" -->
        <div id="my-words-page" class="my-words-page-container" style="display: none;">
            <div class="my-words-header">
                <button id="backToMainFromMyWordsBtn" class="back-button">&larr; Назад</button>
                <h2 class="my-words-title">Мои слова</h2>
            </div>
            <div class="my-words-content">
                <div class="add-custom-word-panel">
                    <h3>Добавить новое слово</h3>
                    <form id="add-custom-word-form" class="custom-word-form">
                        <input type="text" id="word-en-custom" placeholder="Слово на английском" required>
                        <input type="text" id="word-ru-custom" placeholder="Перевод на русский" required>
                        <button type="submit">Добавить</button>
                    </form>
                </div>
                <div class="custom-words-list-panel">
                    <h3>Список добавленных слов</h3>
                    <div id="custom-words-list" class="words-container custom-words-container">
                        <!-- Сюда будут добавляться карточки слов -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Страница Личного кабинета -->
        <div id="profile-page" class="profile-page-container" style="display: none;">
            <div class="profile-header">
                <button id="backToMainFromProfileBtn" class="back-button">&larr; Назад</button>
                <h2 class="profile-title">Личный кабинет</h2>
            </div>
            <div class="profile-content">
                <div class="profile-avatar-section">
                    <div id="profile-avatar-display" class="profile-avatar-display"></div>
                </div>
                <div class="profile-details-section">
                    <p id="profile-displayName" class="profile-name-display"></p>
                    <p id="profile-email" class="profile-email-display"></p>
                    <div class="profile-actions">
                        <button id="logoutBtn" class="profile-action-button logout">Выйти</button>
                        <button id="theme-toggle-btn" class="profile-action-button theme-toggle">Переключить тему</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Админ-панель (скрыта) -->
        <div id="admin-panel" style="display: none;">
            <h2>Панель Администратора</h2>
            <div class="admin-forms">
                <form id="add-category-form">
                    <h3>Добавить категорию</h3>
                    <input type="text" id="category-id" placeholder="ID (например, networking)" required>
                    <input type="text" id="category-name" placeholder="Название (например, Сети)" required>
                    <textarea id="category-desc" placeholder="Описание категории"></textarea>
                    <button type="submit">Добавить категорию</button>
                </form>
                <form id="add-word-form">
                    <h3>Добавить слово</h3>
                    <input type="text" id="word-en" placeholder="Слово (анг.)" required>
                    <input type="text" id="word-ru" placeholder="Перевод" required>
                    <input type="text" id="word-transcription" placeholder="Транскрипция">
                    <textarea id="word-example" placeholder="Пример использования"></textarea>
                    <input type="text" id="word-audio" placeholder="URL аудиофайла">
                    <select id="word-category-select" required>
                        <option value="" disabled selected>Выберите категорию...</option>
                    </select>
                    <button type="submit">Добавить слово</button>
                </form>
            </div>
            <hr>
        </div>

        <!-- Старый словарь (скрыт) -->
        <div class="dictionary-columns" style="display: none;">
            <h2>Словарь</h2>
            <div class="word-column">
                <h3>Новые</h3>
                <div id="new-words-container" class="words-container"></div>
            </div>
            <div class="word-column">
                <h3>Изучаю</h3>
                <div id="learning-words-container" class="words-container"></div>
            </div>
            <div class="word-column">
                <h3>Изучено</h3>
                <div id="learned-words-container" class="words-container"></div>
            </div>
        </div>
    </div>

    <!-- Скрипт подключения Firebase (без изменений) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, doc, addDoc, setDoc, getDoc, updateDoc, increment, getDocs, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAmB_8mAwRyMyPuS37hM3jZxM3zwXYThgY",
            authDomain: "englit-999d9.firebaseapp.com",
            projectId: "englit-999d9",
            storageBucket: "englit-999d9.appspot.com",
            messagingSenderId: "360161037435",
            appId: "1:360161037435:web:fb4d86261183b7fe0aa6de",
            measurementId: "G-RSJPH1B9QY"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.db = db;
        window.collection = collection;
        window.doc = doc;
        window.addDoc = addDoc;
        window.setDoc = setDoc;
        window.getDoc = getDoc;
        window.updateDoc = updateDoc;
        window.increment = increment;
        window.getDocs = getDocs; 
        window.serverTimestamp = serverTimestamp; 
        window.query = query; 
        window.orderBy = orderBy; 
        window.auth = auth;
        window.GoogleAuthProvider = GoogleAuthProvider;
        window.signInWithPopup = signInWithPopup;
        window.signOut = signOut;
        window.onAuthStateChanged = onAuthStateChanged;
    </script>
    
    <script src="script.js" defer></script>
</body>
</html>